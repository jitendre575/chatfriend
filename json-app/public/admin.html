<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Panel - User App</title>
    <link rel="stylesheet" href="style.css">
</head>

<body>
    <!-- Login Overlay -->
    <div id="loginOverlay" class="login-overlay">
        <div class="container">
            <h1>Admin Login</h1>
            <div class="form-group">
                <label for="adminPass">Enter Admin Password</label>
                <input type="password" id="adminPass" placeholder="••••••••">
            </div>
            <button onclick="loginAdmin()" class="btn">Login</button>
            <div id="loginMessage" class="message error"></div>
            <div style="text-align: center; margin-top: 20px;">
                <a href="register.html" style="color: #94a3b8; font-size: 0.8rem; text-decoration: none;">Back to
                    Register</a>
            </div>
        </div>
    </div>

    <!-- Admin Content (hidden by default) -->
    <div id="adminPanel" class="admin-container" style="display: none;">
        <h1 style="text-align: left;">Registered Users</h1>
        <div id="userGrid" class="user-grid">
            <!-- User cards will be injected here -->
        </div>
        <div style="margin-top: 30px; text-align: center;">
            <button onclick="logout()" class="btn"
                style="width: auto; padding: 10px 30px; background: #334155;">Logout</button>
        </div>
    </div>

    <script>
        const loginOverlay = document.getElementById('loginOverlay');
        const adminPanel = document.getElementById('adminPanel');
        const userGrid = document.getElementById('userGrid');
        const loginMessage = document.getElementById('loginMessage');

        // Check if already logged in (sessionStorage)
        if (sessionStorage.getItem('adminLoggedIn') === 'true') {
            showAdminPanel();
        }

        async function loginAdmin() {
            const password = document.getElementById('adminPass').value;

            try {
                const response = await fetch('/api/admin/login', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ password })
                });

                const result = await response.json();

                if (response.ok) {
                    sessionStorage.setItem('adminLoggedIn', 'true');
                    showAdminPanel();
                } else {
                    loginMessage.innerText = result.message;
                    loginMessage.style.display = 'block';
                }
            } catch (error) {
                loginMessage.innerText = 'Error connecting to server';
                loginMessage.style.display = 'block';
            }
        }

        async function showAdminPanel() {
            loginOverlay.style.display = 'none';
            adminPanel.style.display = 'block';
            adminPanel.classList.add('fadeIn');
            fetchUsers();
        }

        async function fetchUsers() {
            try {
                const response = await fetch('/api/admin/users');
                const users = await response.json();

                userGrid.innerHTML = '';

                if (users.length === 0) {
                    userGrid.innerHTML = '<p style="color: #94a3b8; grid-column: 1/-1; text-align: center;">No users registered yet.</p>';
                    return;
                }

                users.forEach(user => {
                    const card = document.createElement('div');
                    card.className = 'user-card';
                    card.innerHTML = `
                        <img src="/uploads/${user.profileImage}" alt="${user.name}" class="user-img" onerror="this.src='https://via.placeholder.com/100'">
                        <div class="user-name">${user.name}</div>
                        <div class="user-email">${user.email}</div>
                    `;
                    userGrid.appendChild(card);
                });
            } catch (error) {
                console.error('Error fetching users:', error);
            }
        }

        function logout() {
            sessionStorage.removeItem('adminLoggedIn');
            location.reload();
        }
    </script>
</body>

</html>